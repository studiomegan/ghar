<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="copyright">
        <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
        <title>Snap</title>
        <script src="snap.svg-min.js"></script>
        <script src="hammer.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <style type="text/css">
        	@import url('https://fonts.googleapis.com/css?family=Open+Sans:800');

			body, html {
				padding:0;
				margin:0;
				height: 100%;
				width: 100%;
			}
        	svg {
    			display: block;
  			}
  			svg text {
  				font-family: 'Open Sans', sans-serif;
				font-weight: 900; 
				font-size: 200px; 
				fill: orange;
			}
			.color {
				fill: blue !important;
			}
        </style>
        <script src="rotodrag.js"></script>
        <script>
			window.onload = function () {
				var s = Snap('100%', '100%');
				var h = s.text(0, 200, 'H');
				var o = s.text(0, 450, 'O');
				var p = s.text(200, 350, 'P');
				var e = s.text(10, 600, 'E');

				var move = function(dx,dy) {
				        this.attr({
				                    transform: this.data('origTransform') + (this.data('origTransform') ? "T" : "t") + [dx, dy]
				                });
				}

				var start = function() {
				        this.data('origTransform', this.transform().local );
				}
				var stop = function() {
				        console.log('finished dragging'); 
				}

				h.drag(move, start, stop).addClass('square');
				o.drag(move, start, stop).addClass('square');
				p.drag(move, start, stop).addClass('square');
				e.drag(move, start, stop).addClass('square');
				
				h.attr({ id: 'stage' });
			
				
			
				// Get a reference to an element
				var square = document.querySelectorAll('.square');;

				// Create a manager to manager the element
				var i;
				for (i = 0; i < square.length; i++) {
					var manager = new Hammer.Manager(square[i]);    

					// Create a recognizer
					var DoubleTap = new Hammer.Tap({
					  event: 'doubletap',
					  taps: 2
					});

					// Add the recognizer to the manager
					manager.add(DoubleTap);

					// Subscribe to desired event
					manager.on('doubletap', function(e) {
					  e.target.classList.toggle('color');
					});
				}

				document.body.addEventListener('touchmove', function(event) {
			        event.preventDefault();
				}, false);

				var stage = document.getElementById('stage');
				var mc = new Hammer.Manager(stage);

				var rotate = new Hammer.Rotate();
				var pinch = new Hammer.Pinch();
				var pan = new Hammer.Pan();

				mc.add([pinch, pan, rotate]);
				mc.get('pinch').set({ enable: true })
				mc.get('rotate').set({ enable: true })

				var adjustScale = 1;
				var currentScale = null;
				var currentRotation = null;
				var adjustRotation = 0;

				var adjustDeltaX = 0;
				var adjustDeltaY = 0;
				var currentDeltaX = null;
				var currentDeltaY = null;

				mc.on("pinch pan rotate", function(e) {
				var transforms = [];
				// var rotation = currentRotation + Math.round(e.rotation);

				currentRotation = adjustRotation + Math.round(e.rotation);
				currentScale = adjustScale * e.scale;
				currentDeltaX = adjustDeltaX + (e.deltaX / currentScale);
				currentDeltaY = adjustDeltaY + (e.deltaY / currentScale);

				transforms.push('scale(' + currentScale + ')');
				transforms.push('translate(' + currentDeltaX + 'px,' + currentDeltaY + 'px)');
				transforms.push('rotate('+currentRotation+'deg)');
				stage.style.transform = transforms.join(' ');

				})

				mc.on("panend pinchend rotateend", function(e) {
				adjustScale = currentScale;
				adjustRotation = currentRotation;
				adjustDeltaX = currentDeltaX;
				adjustDeltaY = currentDeltaY;

			      })
		}

        </script>
        <head></head>
        <body>
        	<div id="svg" preserveAspectRatio="xMinYMin meet"></div>
        </body>
